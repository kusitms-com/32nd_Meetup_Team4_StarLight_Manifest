apiVersion: v1
kind: Secret
metadata:
  name: alertmanager-prometheus-kube-prometheus-alertmanager
  namespace: monitoring
type: Opaque
stringData:
  alertmanager.yaml: |
    global:
      resolve_timeout: 5m

    route:
      group_by: ['alertname', 'namespace', 'severity']
      group_wait: 10s
      group_interval: 5m
      repeat_interval: 12h
      receiver: 'discord-critical'
      routes:
        - match:
            severity: critical
          receiver: 'discord-critical'
          continue: true
        - match:
            severity: warning
          receiver: 'discord-warning'

    receivers:
    - name: 'discord-critical'
      slack_configs:
      - api_url: 'https://discord.com/api/webhooks/--/gfg7SX8DcXHywSiTnDFQuuoZy9sXCJtw3NNgpkYL1XBEWd7Az0MuoP9S3OFjwz4hr2qU/slack'
        send_resolved: true
        channel: '#general'
        # ì œëª©ì— ì´ë¯¸ CRITICALì´ ìˆìœ¼ë‹ˆ ë³¸ë¬¸ì—” ì—†ì–´ë„ ë¨
        title: 'ğŸš¨ [{{ .Status | toUpper }}] {{ .GroupLabels.alertname }} (CRITICAL)'
        text: |
          ### âš¡ï¸ë„¤ì„ìŠ¤í˜ì´ìŠ¤: {{ .GroupLabels.namespace }}
          {{ range .Alerts }}
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          ### ğŸ“ ìš”ì•½ (Summary):
          {{ .Annotations.summary }}
    
          ### ğŸ” ìƒì„¸ ë‚´ìš© (Description):
          >>> {{ .Annotations.description }}
    
          **ë°œìƒ ìœ„ì¹˜ (Target):**
          `{{ .Labels.instance }}` {{ if .Labels.pod }}(Pod: `{{ .Labels.pod }}`){{ end }}
    
          **ë°œìƒ ì‹œê°:**
          {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    - name: 'discord-warning'
      slack_configs:
      - api_url: 'https://discord.com/api/webhooks/--/gfg7SX8DcXHywSiTnDFQuuoZy9sXCJtw3NNgpkYL1XBEWd7Az0MuoP9S3OFjwz4hr2qU/slack'
        send_resolved: true
        # ì œëª©ì— ì´ë¯¸ WARNINGì´ ìˆìœ¼ë‹ˆ ë³¸ë¬¸ì—” ì—†ì–´ë„ ë¨
        title: 'âš ï¸ [{{ .Status | toUpper }}] {{ .GroupLabels.alertname }} (WARNING)'
        text: |
          ### ğŸ“ ë„¤ì„ìŠ¤í˜ì´ìŠ¤: {{ .GroupLabels.namespace }}
    
          {{ range .Alerts }}
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          ### ğŸ“ ìš”ì•½ (Summary):
          {{ .Annotations.summary }}
    
          ### ğŸ” ìƒì„¸ ë‚´ìš© (Description):
          >>> {{ .Annotations.description }}
    
          **ë°œìƒ ìœ„ì¹˜ (Target):**
          `{{ .Labels.instance }}` {{ if .Labels.pod }}(Pod: `{{ .Labels.pod }}`){{ end }}

          **ë°œìƒ ì‹œê°:**
          {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”