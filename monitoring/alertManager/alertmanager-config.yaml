apiVersion: v1
kind: Secret
metadata:
  name: alertmanager-prometheus-kube-prometheus-alertmanager
  namespace: monitoring
type: Opaque
stringData:
  alertmanager.yaml: |
    global:
      resolve_timeout: 5m

    route:
      group_by: ['alertname', 'namespace', 'severity']
      group_wait: 10s
      group_interval: 5m
      repeat_interval: 12h
      receiver: 'discord-critical'
      routes:
        - match:
            alertname: Watchdog
          receiver: 'discord-watchdog'
          repeat_interval: 24h   # 24ì‹œê°„ì— í•œ ë²ˆë§Œ íˆ­ ì˜ê²Œ (ì›í•˜ë©´ ë” ê¸¸ê²Œë„ ê°€ëŠ¥)
    
        - match:
            severity: critical
          receiver: 'discord-critical'
          continue: true
    
        - match:
            severity: warning
          receiver: 'discord-warning'

    receivers:
    - name: 'discord-watchdog'
      slack_configs:
      - api_url: 'https://discord.com/api/webhooks/--/--/slack'
        send_resolved: false
        channel: '#general'
        color: 'good'
        
        title: 'ğŸ¤– ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì •ìƒ ë™ì‘ ì¤‘ (Watchdog)'
        text: |
          ì•ˆë…•í•˜ì„¸ìš”, StarLight ëª¨ë‹ˆí„°ë§ ë¹„ì„œ **Watchdog** ì…ë‹ˆë‹¤ ğŸ¶
      
          ì§€ê¸ˆ ì‹œê° ê¸°ì¤€ìœ¼ë¡œ 
          **Prometheus â†’ Alertmanager â†’ Discord** ì•Œë¦¼ íŒŒì´í”„ë¼ì¸ì´ **ì •ìƒ ë™ì‘** ì¤‘ì…ë‹ˆë‹¤ 
      
          {{ range .Alerts }}
          - ì•ŒëŒ ì´ë¦„: `{{ .Labels.alertname }}`
          - ìƒíƒœ: `{{ .Status }}`
          - ì²˜ìŒ ë°œìƒ ì‹œê°: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
      
          ì´ ë©”ì‹œì§€ê°€ ê°€ë”ì”© ë³´ì´ë©´:  
          ğŸ‘‰ "*ì•„, ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì€ ì˜ ì‚´ì•„ìˆêµ¬ë‚˜*" ë¼ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤ ğŸ˜
          ë§Œì•½ **ì´ ë©”ì‹œì§€ê°€ í•œë™ì•ˆ ì•ˆ ì˜¨ë‹¤**ë©´, ê·¸ ë•Œê°€ ì§„ì§œ ë¬¸ì œì˜ˆìš”... ğŸ§¯
    
    - name: 'discord-critical'
      slack_configs:
      - api_url: 'https://discord.com/api/webhooks/--/--/slack'
        send_resolved: true
        channel: '#general'
        # ì œëª©ì— ì´ë¯¸ CRITICALì´ ìˆìœ¼ë‹ˆ ë³¸ë¬¸ì—” ì—†ì–´ë„ ë¨
        title: 'ğŸš¨ [{{ .Status | toUpper }}] {{ .GroupLabels.alertname }} (CRITICAL)'
        text: |
          ### âš¡ï¸ë„¤ì„ìŠ¤í˜ì´ìŠ¤: {{ .GroupLabels.namespace }}
          {{ range .Alerts }}
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          ### ğŸ“ ìš”ì•½ (Summary):
          {{ .Annotations.summary }}
    
          ### ğŸ” ìƒì„¸ ë‚´ìš© (Description):
          >>> {{ .Annotations.description }}
    
          **ë°œìƒ ìœ„ì¹˜ (Target):**
          `{{ .Labels.instance }}` {{ if .Labels.pod }}(Pod: `{{ .Labels.pod }}`){{ end }}
    
          **ë°œìƒ ì‹œê°:**
          {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    - name: 'discord-warning'
      slack_configs:
      - api_url: 'https://discord.com/api/webhooks/--/--/slack'
        send_resolved: true
        # ì œëª©ì— ì´ë¯¸ WARNINGì´ ìˆìœ¼ë‹ˆ ë³¸ë¬¸ì—” ì—†ì–´ë„ ë¨
        title: 'âš ï¸ [{{ .Status | toUpper }}] {{ .GroupLabels.alertname }} (WARNING)'
        text: |
          ### ğŸ“ ë„¤ì„ìŠ¤í˜ì´ìŠ¤: {{ .GroupLabels.namespace }}
    
          {{ range .Alerts }}
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          ### ğŸ“ ìš”ì•½ (Summary):
          {{ .Annotations.summary }}
    
          ### ğŸ” ìƒì„¸ ë‚´ìš© (Description):
          >>> {{ .Annotations.description }}
    
          **ë°œìƒ ìœ„ì¹˜ (Target):**
          `{{ .Labels.instance }}` {{ if .Labels.pod }}(Pod: `{{ .Labels.pod }}`){{ end }}

          **ë°œìƒ ì‹œê°:**
          {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
